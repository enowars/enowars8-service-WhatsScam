import datetime
from httpx import AsyncClient
import random
import string
from bs4 import BeautifulSoup



async def putflag():
    addr = "localhost"
    client = AsyncClient(
            base_url=f"http://{addr}:{9696}"
        )
    ######
    email = '11'.join(random.choice(string.ascii_lowercase) for _ in range(20)) + "@example.com"
    firstName = ''.join(random.choice(string.ascii_lowercase) for _ in range(10))
    password1 = ''.join(random.choice(string.ascii_lowercase) for _ in range(10))
    password2 = password1
    public_key = "on"
    #public_key = "None"
    start_time = datetime.datetime.now()
    
    response = await client.post(
        "/sign-up",
        data={
            "email": email,
            "firstName": firstName,
            "public_key": public_key,
            "password1": password1,
            "password2": password2,
        },
        follow_redirects=True,
    )
    timetaken = datetime.datetime.now() - start_time
    ######
    second_break = datetime.datetime.now()
    
    response = await client.get("/logout", follow_redirects=True)
    
    return timetaken

if __name__ == "__main__":
    import asyncio
    total_time = datetime.datetime.now()
    m = 100000
    n = []
    total_time = datetime.timedelta(0)
    for i in range(m):
        c = datetime.datetime.now()
        timetaken = asyncio.run(putflag())
        total_time += timetaken
        print("Time taken for iteration ", i, " is ", timetaken)
    
    print("Total time taken is ", total_time)
    
    